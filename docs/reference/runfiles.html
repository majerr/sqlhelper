<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Accepts a character vector of SQL file names and runs each one on either hive
or postgresql."><title>Execute a list of .sql files — runfiles • sqlhelper</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Execute a list of .sql files — runfiles"><meta property="og:description" content="Accepts a character vector of SQL file names and runs each one on either hive
or postgresql."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sqlhelper</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/sqlhelper.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/connections.html">Managing Connections</a>
    <a class="dropdown-item" href="../articles/sql_execution.html">Executing SQL</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Execute a list of .sql files</h1>
      
      <div class="d-none name"><code>runfiles.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Accepts a character vector of SQL file names and runs each one on either hive
or postgresql.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">runfiles</span><span class="op">(</span></span>
<span>  <span class="va">filenames</span>,</span>
<span>  quotesql <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  execmethod <span class="op">=</span> <span class="st">"get"</span>,</span>
<span>  geometry <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  default_conn <span class="op">=</span> <span class="fu"><a href="live_connection.html">live_connection</a></span><span class="op">(</span><span class="fu"><a href="set_default_conn_name.html">get_default_conn_name</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  include_params <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>filenames</dt>
<dd><p>A character vector containing your sql file names, including
paths if they are not in the working directory</p></dd>


<dt>db</dt>
<dd><p>Defaults to 'cds' which is the only option on the DAP
Although you <em>can</em> specify <code>db</code> as a parameter, the preferred way is
to include a <code>-- db=&lt;dbname&gt;</code> comment in your sql file. See details.</p></dd>


<dt>interpolate</dt>
<dd><p>defaults to the value of <code><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame()</a></code>. May be set
to <code>FALSE</code> if interpolation to be avoided, or to another environment
to control the source of the used. This can be useful if <code>sqlhelper</code> is
used to run SQL from within another package, and you don't want to
interfere with <code>.GlobalEnv</code>. See details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Depending on the input, <code>runfiles</code> returns one of:</p>


<dl><dt><strong>A list of lists</strong> (for multiple files)</dt>
<dd><p>The outer list
contains one list for each file in filenames. Each inner list is named with
the file basename and contains the results of each query from that file.</p></dd>


<dt><strong>A list</strong> (for a single file containing several queries)</dt>
<dd><p>Each
element is the result of a query.</p></dd>


<dt><strong>An R object</strong> (for files containing a single query).</dt>
<dd><p>The
result of the query, e.g. a dataframe for a <code>SELECT</code> statement, or a
single element character vector for a <code>CREATE TABLE</code> statement.</p></dd>
 
</dl><p><code>runfiles()</code> will try to flatten the list intelligently so that you
don't have to name lots of containers that contain only one element to
inspect your results. But this may mean that you get a dataframe where you
were expecting a list, e.g. if your file contains only one query.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Before queries are sent to the database for execution,
<code>runfiles</code> interprets comments and parameterizes queries.</p>
<p><strong>Comment interpretation:</strong></p>
<p><code>sqlhelper</code> can extract parameters from two kinds of SQL comments. Both
must occur on a line by themselves.</p>
<dl><dt><code>-- db=cds</code></dt>
<dd><p>The <code>db</code> parameter is legacy from previous versions of the package,
where multiple databases were available.
For use on the DAP, 'cds' is the only accepted value. Case insensitive. Use this
once before the first query in the file. Don't quote the parameter! For example,
use <code>-- db=cds</code>, NOT <code>-- db="cds"</code>.</p></dd>


<dt><code>-- qname=&lt;a_name_for_this_query&gt;</code></dt>
<dd><p>The <code>qname</code> parameter
assigns a name to each query, which can then be used to access the result
of that query. Don't quote the parameter! For example,
if your query is called create_tab, use <code>-- qname=create_tab</code>, NOT <code>-- qname="create_tab"</code>.</p></dd>



</dl><p><strong>Query parameterization:</strong></p>
<p>Queries may be parameterized with values from the R. In fact you may run
arbitrary R code to parameterize your queries. Parameters are enclosed in
braces (<code>{...}</code>). So if you have defined a parameter <code>max_rows</code>
in R:</p>
<p><code>max_rows &lt;- 10</code></p>
<p>You might use it in your SQLServer code as part of a TOP clause to get 10 rows of a
table:</p>
<p><code>SELECT TOP {max_rows} * FROM mytable</code></p>
<p>Before your query is submitted to the server, it will be parameterized to:</p>
<p><code>SELECT TOP 10 * FROM mytable</code></p>
<p>By default, parameters are searched for from the package up to the global
environment, so if you have defined your parameters globally, they will be
found. You might not always want this though. For example, if you are
calling <code>runfiles</code> to run parameterized SQL from within a package, you
shouldn't interfere with your user's global environment. In this case you
will want to pass in an environment containing the required parameters. In this
case use the <code>interpolate</code> argument:</p>
<div class="sourceCode"><pre><code>
  &gt;param_env &lt;- new.env()
  &gt;param_env$max_rows &lt;- 10
  &gt;runfiles("my_queries.sql", interpolate=param_env)
  </code></pre></div>

<p>If you want to avoid parameterization from R altogether, set the
<code>interpolate</code> parameter to <code>FALSE</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other SQL runners: 
<code><a href="runqueries.html">runqueries</a>()</code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Matthew Roberts.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

